<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 9 Data understanding | Regression and Classification with Tidymodels</title>
<meta name="author" content="Jan Kirenz">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.6.6/header-attrs.js"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.4.9000/tabs.js"></script><script src="libs/bs3compat-0.2.4.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS --><link rel="stylesheet" href="css/dsbox.css">
<link rel="stylesheet" href="css/fontawesome/css/all.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Regression and Classification with Tidymodels</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li class="book-part">DATA SCIENCE LIFECYCLE</li>
<li><a class="" href="crisp-dm.html"><span class="header-section-number">1</span> CRISP-DM</a></li>
<li class="book-part">REGRESSION</li>
<li><a class="" href="intro.html"><span class="header-section-number">2</span> Introduction</a></li>
<li><a class="" href="business-understanding-1.html"><span class="header-section-number">3</span> Business understanding</a></li>
<li><a class="" href="data-understanding-1.html"><span class="header-section-number">4</span> Data understanding</a></li>
<li><a class="" href="data-preparation-1.html"><span class="header-section-number">5</span> Data preparation</a></li>
<li><a class="" href="model-building.html"><span class="header-section-number">6</span> Model building</a></li>
<li class="book-part">CLASSIFICATION</li>
<li><a class="" href="intro2.html"><span class="header-section-number">7</span> Introduction</a></li>
<li><a class="" href="business-understanding-2.html"><span class="header-section-number">8</span> Business understanding</a></li>
<li><a class="active" href="data-understanding-2.html"><span class="header-section-number">9</span> Data understanding</a></li>
<li><a class="" href="data-preparation-3.html"><span class="header-section-number">10</span> Data preparation</a></li>
<li><a class="" href="model-building-1.html"><span class="header-section-number">11</span> Model building</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/kirenz/tidymodels">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="data-understanding-2" class="section level1" number="9">
<h1>
<span class="header-section-number">9</span> Data understanding<a class="anchor" aria-label="anchor" href="#data-understanding-2"><i class="fas fa-link"></i></a>
</h1>
<div class="note">
<p>In Data Understanding, you:</p>
<ul>
<li>Import data</li>
<li>Clean data</li>
<li>Format data properly</li>
<li>Create new variables</li>
<li>Get an overview about the complete data</li>
<li>Split data into training and test set using stratified sampling</li>
<li>Discover and visualize the data to gain insights</li>
</ul>
</div>
<div id="imort-data-1" class="section level2" number="9.1">
<h2>
<span class="header-section-number">9.1</span> Imort Data<a class="anchor" aria-label="anchor" href="#imort-data-1"><i class="fas fa-link"></i></a>
</h2>
<p>First of all, let’s import the data:</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>

<span class="va">LINK</span> <span class="op">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/kirenz/datasets/master/housing_unclean.csv"</span>
<span class="va">housing_df</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="va">LINK</span><span class="op">)</span></code></pre></div>
</div>
<div id="clean-data-1" class="section level2" number="9.2">
<h2>
<span class="header-section-number">9.2</span> Clean data<a class="anchor" aria-label="anchor" href="#clean-data-1"><i class="fas fa-link"></i></a>
</h2>
<p>To get a first impression of the data we take a look at the top 4 rows:</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rstudio/gt">gt</a></span><span class="op">)</span>

<span class="va">housing_df</span> <span class="op">%&gt;%</span> 
  <span class="fu">slice_head</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/gt/man/gt.html">gt</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># print output using gt</span></code></pre></div>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#qfynujyosv .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#qfynujyosv .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qfynujyosv .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#qfynujyosv .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#qfynujyosv .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qfynujyosv .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qfynujyosv .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#qfynujyosv .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#qfynujyosv .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#qfynujyosv .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#qfynujyosv .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#qfynujyosv .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#qfynujyosv .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#qfynujyosv .gt_from_md > :first-child {
  margin-top: 0;
}

#qfynujyosv .gt_from_md > :last-child {
  margin-bottom: 0;
}

#qfynujyosv .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#qfynujyosv .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#qfynujyosv .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qfynujyosv .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#qfynujyosv .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qfynujyosv .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#qfynujyosv .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#qfynujyosv .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qfynujyosv .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qfynujyosv .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#qfynujyosv .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qfynujyosv .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#qfynujyosv .gt_left {
  text-align: left;
}

#qfynujyosv .gt_center {
  text-align: center;
}

#qfynujyosv .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#qfynujyosv .gt_font_normal {
  font-weight: normal;
}

#qfynujyosv .gt_font_bold {
  font-weight: bold;
}

#qfynujyosv .gt_font_italic {
  font-style: italic;
}

#qfynujyosv .gt_super {
  font-size: 65%;
}

#qfynujyosv .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="qfynujyosv" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><div class="inline-table"><table class="gt_table">
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">longitude</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">latitude</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">housing_median_age</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">total_rooms</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">total_bedrooms</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">population</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">households</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">median_income</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">median_house_value</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">ocean_proximity</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td class="gt_row gt_right">-122</td>
      <td class="gt_row gt_right">38</td>
      <td class="gt_row gt_left">41.0years</td>
      <td class="gt_row gt_right">880</td>
      <td class="gt_row gt_right">129</td>
      <td class="gt_row gt_right">322</td>
      <td class="gt_row gt_right">126</td>
      <td class="gt_row gt_right">8.3</td>
      <td class="gt_row gt_left">452600.0$</td>
      <td class="gt_row gt_left">NEAR BAY</td>
    </tr>
<tr>
<td class="gt_row gt_right">-122</td>
      <td class="gt_row gt_right">38</td>
      <td class="gt_row gt_left">21.0</td>
      <td class="gt_row gt_right">7099</td>
      <td class="gt_row gt_right">1106</td>
      <td class="gt_row gt_right">2401</td>
      <td class="gt_row gt_right">1138</td>
      <td class="gt_row gt_right">8.3</td>
      <td class="gt_row gt_left">358500.0</td>
      <td class="gt_row gt_left">NEAR BAY</td>
    </tr>
<tr>
<td class="gt_row gt_right">-122</td>
      <td class="gt_row gt_right">38</td>
      <td class="gt_row gt_left">52.0</td>
      <td class="gt_row gt_right">1467</td>
      <td class="gt_row gt_right">190</td>
      <td class="gt_row gt_right">496</td>
      <td class="gt_row gt_right">177</td>
      <td class="gt_row gt_right">7.3</td>
      <td class="gt_row gt_left">352100.0</td>
      <td class="gt_row gt_left">NEAR BAY</td>
    </tr>
<tr>
<td class="gt_row gt_right">-122</td>
      <td class="gt_row gt_right">38</td>
      <td class="gt_row gt_left">52.0</td>
      <td class="gt_row gt_right">1274</td>
      <td class="gt_row gt_right">235</td>
      <td class="gt_row gt_right">558</td>
      <td class="gt_row gt_right">219</td>
      <td class="gt_row gt_right">5.6</td>
      <td class="gt_row gt_left">341300.0</td>
      <td class="gt_row gt_left">NEAR BAY</td>
    </tr>
</tbody>
</table></div></div>
<p>Notice the values in the first row of the variables <code>housing_median_age</code>and <code>median_house_value</code>. We need to remove the strings “years” and “$.” Therefore, we use the function <code>str_remove_all</code> from the <code>stringr</code> package. Since there could be multiple wrong entries of the same type, we apply our corrections to all of the rows of the corresponding variable:</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://stringr.tidyverse.org">stringr</a></span><span class="op">)</span>

<span class="va">housing_df</span> <span class="op">&lt;-</span> 
  <span class="va">housing_df</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>
    housing_median_age <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove_all</a></span><span class="op">(</span><span class="va">housing_median_age</span>, <span class="st">"[years]"</span><span class="op">)</span>,
    median_house_value <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove_all</a></span><span class="op">(</span><span class="va">median_house_value</span>, <span class="st">"[$]"</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<p>We don’t cover the phase of data cleaning in detail in this tutorial. However, in a real data science project, data cleaning is usually a very time consuming process.</p>
</div>
<div id="format-data-1" class="section level2" number="9.3">
<h2>
<span class="header-section-number">9.3</span> Format data<a class="anchor" aria-label="anchor" href="#format-data-1"><i class="fas fa-link"></i></a>
</h2>
<p>Next, we take a look at the data structure and check wether all data formats are correct:</p>
<ul>
<li><p>Numeric variables should be formatted as integers (<code>int</code>) or double precision floating point numbers (<code>dbl</code>).</p></li>
<li><p>Categorical (nominal and ordinal) variables should usually be formatted as factors (<code>fct</code>) and not characters (<code>chr</code>). Especially, if they don’t have many levels.</p></li>
</ul>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu">glimpse</span><span class="op">(</span><span class="va">housing_df</span><span class="op">)</span>
<span class="co">#&gt; Rows: 20,640</span>
<span class="co">#&gt; Columns: 10</span>
<span class="co">#&gt; $ longitude          &lt;dbl&gt; -122, -122, -122, -122, -122, -122, -122, -122, -1…</span>
<span class="co">#&gt; $ latitude           &lt;dbl&gt; 38, 38, 38, 38, 38, 38, 38, 38, 38, 38, 38, 38, 38…</span>
<span class="co">#&gt; $ housing_median_age &lt;chr&gt; "41.0", "21.0", "52.0", "52.0", "52.0", "52.0", "5…</span>
<span class="co">#&gt; $ total_rooms        &lt;dbl&gt; 880, 7099, 1467, 1274, 1627, 919, 2535, 3104, 2555…</span>
<span class="co">#&gt; $ total_bedrooms     &lt;dbl&gt; 129, 1106, 190, 235, 280, 213, 489, 687, 665, 707,…</span>
<span class="co">#&gt; $ population         &lt;dbl&gt; 322, 2401, 496, 558, 565, 413, 1094, 1157, 1206, 1…</span>
<span class="co">#&gt; $ households         &lt;dbl&gt; 126, 1138, 177, 219, 259, 193, 514, 647, 595, 714,…</span>
<span class="co">#&gt; $ median_income      &lt;dbl&gt; 8.3, 8.3, 7.3, 5.6, 3.8, 4.0, 3.7, 3.1, 2.1, 3.7, …</span>
<span class="co">#&gt; $ median_house_value &lt;chr&gt; "452600.0", "358500.0", "352100.0", "341300.0", "3…</span>
<span class="co">#&gt; $ ocean_proximity    &lt;chr&gt; "NEAR BAY", "NEAR BAY", "NEAR BAY", "NEAR BAY", "N…</span></code></pre></div>
<p>The package <code>visdat</code> helps us to explore the data class structure visually:</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://visdat.njtierney.com/">visdat</a></span><span class="op">)</span>

<span class="fu"><a href="http://visdat.njtierney.com//reference/vis_dat.html">vis_dat</a></span><span class="op">(</span><span class="va">housing_df</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="Tidymodels_files/figure-html/unnamed-chunk-65-1.png" width="100%" height="100%" style="display: block; margin: auto;"></div>
<p>We can observe that the numeric variables <code>housing_media_age</code> and <code>median_house_value</code> are declared as characters (<code>chr</code>) instead of numeric. We choose to format the variables as <code>dbl</code>, since the values could be floating-point numbers.</p>
<p>Furthermore, the categorical variable <code>ocean_proximity</code> is formatted as character instead of factor. Let’s take a look at the levels of the variable:</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">housing_df</span> <span class="op">%&gt;%</span> 
  <span class="fu">count</span><span class="op">(</span><span class="va">ocean_proximity</span>,
        sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 5 x 2</span>
<span class="co">#&gt;   ocean_proximity     n</span>
<span class="co">#&gt;   &lt;chr&gt;           &lt;int&gt;</span>
<span class="co">#&gt; 1 &lt;1H OCEAN        9136</span>
<span class="co">#&gt; 2 INLAND           6551</span>
<span class="co">#&gt; 3 NEAR OCEAN       2658</span>
<span class="co">#&gt; 4 NEAR BAY         2290</span>
<span class="co">#&gt; 5 ISLAND              5</span></code></pre></div>
<p>The variable has only 5 levels and therefore should be formatted as a factor.</p>
<p>Note that it is usually a good idea to first take care of the numerical variables. Afterwards, we can easily convert all remaining character variables to factors using the function <code>across</code> from the dplyr package (which is part of the tidyverse).</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># convert to numeric</span>
<span class="va">housing_df</span> <span class="op">&lt;-</span> 
  <span class="va">housing_df</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>
    housing_median_age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">housing_median_age</span><span class="op">)</span>,
    median_house_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">median_house_value</span><span class="op">)</span>
  <span class="op">)</span>

<span class="co"># convert all remaining character variables to factors </span>
<span class="va">housing_df</span> <span class="op">&lt;-</span> 
  <span class="va">housing_df</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.character</span><span class="op">)</span>, <span class="va">as.factor</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="missing-data-1" class="section level2" number="9.4">
<h2>
<span class="header-section-number">9.4</span> Missing data<a class="anchor" aria-label="anchor" href="#missing-data-1"><i class="fas fa-link"></i></a>
</h2>
<p>Now let’s turn our attention to missing data. Missing data can be viewed with the function <code>vis_miss</code> from the package <code>visdat</code>. We arrange the data by columns with most missingness:</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu"><a href="http://visdat.njtierney.com//reference/vis_miss.html">vis_miss</a></span><span class="op">(</span><span class="va">housing_df</span>, sort_miss <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="Tidymodels_files/figure-html/unnamed-chunk-68-1.png" width="100%" height="100%" style="display: block; margin: auto;"></div>
<p>Here an alternative method to obtain missing data:</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">housing_df</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt;          longitude           latitude housing_median_age        total_rooms </span>
<span class="co">#&gt;                  0                  0                  0                  0 </span>
<span class="co">#&gt;     total_bedrooms         population         households      median_income </span>
<span class="co">#&gt;                207                  0                  0                  0 </span>
<span class="co">#&gt; median_house_value    ocean_proximity </span>
<span class="co">#&gt;                  0                  0</span></code></pre></div>
<p>We have a missing rate of 0.1% (207 cases) in our variable <code>total_bedroms</code>. This can cause problems for some algorithms. We will take care of this issue during our data preparation phase.</p>
</div>
<div id="create-new-variables-1" class="section level2" number="9.5">
<h2>
<span class="header-section-number">9.5</span> Create new variables<a class="anchor" aria-label="anchor" href="#create-new-variables-1"><i class="fas fa-link"></i></a>
</h2>
<p>One very important thing you may want to do at the beginning of your data science project is to create new variable combinations. For example:</p>
<ul>
<li><p>the <em>total number of rooms</em> in a district is not very useful if you don’t know how many households there are. What you really want is the <em>number of rooms per household</em>.</p></li>
<li><p>Similarly, the total number of bedrooms by itself is not very useful: you probably want to compare it to the number of rooms.</p></li>
<li><p>And the <em>population per household</em> also seems like an interesting attribute combination to look at.</p></li>
</ul>
<p>Let’s create these new attributes:</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">housing_df</span> <span class="op">&lt;-</span> 
  <span class="va">housing_df</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>rooms_per_household <span class="op">=</span> <span class="va">total_rooms</span><span class="op">/</span><span class="va">households</span>,
        bedrooms_per_room <span class="op">=</span> <span class="va">total_bedrooms</span><span class="op">/</span><span class="va">total_rooms</span>,
        population_per_household <span class="op">=</span> <span class="va">population</span><span class="op">/</span><span class="va">households</span><span class="op">)</span></code></pre></div>
<p>Furthermore, in our example we need to create our dependent variable and drop the original numeric variable:</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">housing_df</span> <span class="op">&lt;-</span> 
  <span class="va">housing_df</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>price_category <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span> 
    <span class="va">median_house_value</span> <span class="op">&lt;</span> <span class="fl">150000</span> <span class="op">~</span> <span class="st">"below"</span>,
    <span class="va">median_house_value</span> <span class="op">&gt;=</span> <span class="fl">150000</span> <span class="op">~</span> <span class="st">"above"</span>,
    <span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>price_category <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">price_category</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">median_house_value</span><span class="op">)</span></code></pre></div>
<p>Take a look at our dependent variable and create a table with the package <a href="https://gt.rstudio.com/"><code>gt</code></a></p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rstudio/gt">gt</a></span><span class="op">)</span>

<span class="va">housing_df</span> <span class="op">%&gt;%</span> 
  <span class="fu">count</span><span class="op">(</span><span class="va">price_category</span>, <span class="co"># count observations</span>
        name <span class="op">=</span><span class="st">"districts_total"</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co"># name the new variable </span>
  <span class="fu">mutate</span><span class="op">(</span>percent <span class="op">=</span> <span class="va">districts_total</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">districts_total</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co"># calculate percentages</span>
  <span class="fu"><a href="https://rdrr.io/pkg/gt/man/gt.html">gt</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># create table</span></code></pre></div>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#amucjibsfg .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#amucjibsfg .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#amucjibsfg .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#amucjibsfg .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#amucjibsfg .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#amucjibsfg .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#amucjibsfg .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#amucjibsfg .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#amucjibsfg .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#amucjibsfg .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#amucjibsfg .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#amucjibsfg .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#amucjibsfg .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#amucjibsfg .gt_from_md > :first-child {
  margin-top: 0;
}

#amucjibsfg .gt_from_md > :last-child {
  margin-bottom: 0;
}

#amucjibsfg .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#amucjibsfg .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#amucjibsfg .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#amucjibsfg .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#amucjibsfg .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#amucjibsfg .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#amucjibsfg .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#amucjibsfg .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#amucjibsfg .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#amucjibsfg .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#amucjibsfg .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#amucjibsfg .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#amucjibsfg .gt_left {
  text-align: left;
}

#amucjibsfg .gt_center {
  text-align: center;
}

#amucjibsfg .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#amucjibsfg .gt_font_normal {
  font-weight: normal;
}

#amucjibsfg .gt_font_bold {
  font-weight: bold;
}

#amucjibsfg .gt_font_italic {
  font-style: italic;
}

#amucjibsfg .gt_super {
  font-size: 65%;
}

#amucjibsfg .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="amucjibsfg" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><div class="inline-table"><table class="gt_table">
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">price_category</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">districts_total</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">percent</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td class="gt_row gt_center">above</td>
      <td class="gt_row gt_center">13084</td>
      <td class="gt_row gt_right">0.63</td>
    </tr>
<tr>
<td class="gt_row gt_center">below</td>
      <td class="gt_row gt_center">7556</td>
      <td class="gt_row gt_right">0.37</td>
    </tr>
</tbody>
</table></div></div>
<p>Let’s make a nice looking table:</p>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">housing_df</span> <span class="op">%&gt;%</span> 
  <span class="fu">count</span><span class="op">(</span><span class="va">price_category</span>, 
        name <span class="op">=</span><span class="st">"districts_total"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>percent <span class="op">=</span> <span class="va">districts_total</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">districts_total</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
 <span class="fu"><a href="https://rdrr.io/pkg/gt/man/gt.html">gt</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/gt/man/tab_header.html">tab_header</a></span><span class="op">(</span>
    title <span class="op">=</span> <span class="st">"California median house prices"</span>,
    subtitle <span class="op">=</span> <span class="st">"Districts above and below 150.000$"</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/gt/man/cols_label.html">cols_label</a></span><span class="op">(</span>
    price_category <span class="op">=</span> <span class="st">"Price"</span>,
    districts_total <span class="op">=</span> <span class="st">"Districts"</span>,
    percent <span class="op">=</span> <span class="st">"Percent"</span>
  <span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/gt/man/fmt_number.html">fmt_number</a></span><span class="op">(</span>
    columns <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">districts_total</span><span class="op">)</span>,
    suffixing <span class="op">=</span> <span class="cn">TRUE</span>
  <span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/gt/man/fmt_percent.html">fmt_percent</a></span><span class="op">(</span>
    columns <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">percent</span><span class="op">)</span>,
    decimal <span class="op">=</span> <span class="fl">2</span>
  <span class="op">)</span></code></pre></div>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#fcmdvxjzej .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#fcmdvxjzej .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#fcmdvxjzej .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#fcmdvxjzej .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#fcmdvxjzej .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fcmdvxjzej .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#fcmdvxjzej .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#fcmdvxjzej .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#fcmdvxjzej .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#fcmdvxjzej .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#fcmdvxjzej .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#fcmdvxjzej .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#fcmdvxjzej .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#fcmdvxjzej .gt_from_md > :first-child {
  margin-top: 0;
}

#fcmdvxjzej .gt_from_md > :last-child {
  margin-bottom: 0;
}

#fcmdvxjzej .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#fcmdvxjzej .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#fcmdvxjzej .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#fcmdvxjzej .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#fcmdvxjzej .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#fcmdvxjzej .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#fcmdvxjzej .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#fcmdvxjzej .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fcmdvxjzej .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#fcmdvxjzej .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#fcmdvxjzej .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#fcmdvxjzej .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#fcmdvxjzej .gt_left {
  text-align: left;
}

#fcmdvxjzej .gt_center {
  text-align: center;
}

#fcmdvxjzej .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#fcmdvxjzej .gt_font_normal {
  font-weight: normal;
}

#fcmdvxjzej .gt_font_bold {
  font-weight: bold;
}

#fcmdvxjzej .gt_font_italic {
  font-style: italic;
}

#fcmdvxjzej .gt_super {
  font-size: 65%;
}

#fcmdvxjzej .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="fcmdvxjzej" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><div class="inline-table"><table class="gt_table">
<thead class="gt_header">
<tr>
<th colspan="3" class="gt_heading gt_title gt_font_normal" style>California median house prices</th>
    </tr>
<tr>
<th colspan="3" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style>Districts above and below 150.000$</th>
    </tr>
</thead>
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">Price</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">Districts</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Percent</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td class="gt_row gt_center">above</td>
      <td class="gt_row gt_center">13.08K</td>
      <td class="gt_row gt_right">63.39&amp;percnt;</td>
    </tr>
<tr>
<td class="gt_row gt_center">below</td>
      <td class="gt_row gt_center">7.56K</td>
      <td class="gt_row gt_right">36.61&amp;percnt;</td>
    </tr>
</tbody>
</table></div></div>
</div>
<div id="data-overview-1" class="section level2" number="9.6">
<h2>
<span class="header-section-number">9.6</span> Data overview<a class="anchor" aria-label="anchor" href="#data-overview-1"><i class="fas fa-link"></i></a>
</h2>
<p>After we took care of our data problems, we can obtain a data summary of all numerical and categorical attributes using a function from the package <code>skimr</code>:</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu">skim</span><span class="op">(</span><span class="va">housing_df</span><span class="op">)</span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:unnamed-chunk-74">Table 9.1: </span>Data summary</caption>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">housing_df</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">20640</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">13</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">factor</td>
<td align="left">2</td>
</tr>
<tr class="odd">
<td align="left">numeric</td>
<td align="left">11</td>
</tr>
<tr class="even">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Group variables</td>
<td align="left">None</td>
</tr>
</tbody>
</table></div>
<p><strong>Variable type: factor</strong></p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="left">ordered</th>
<th align="right">n_unique</th>
<th align="left">top_counts</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">ocean_proximity</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="right">5</td>
<td align="left">&lt;1H: 9136, INL: 6551, NEA: 2658, NEA: 2290</td>
</tr>
<tr class="even">
<td align="left">price_category</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="right">2</td>
<td align="left">abo: 13084, bel: 7556</td>
</tr>
</tbody>
</table></div>
<p><strong>Variable type: numeric</strong></p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
<th align="left">hist</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">longitude</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">-119.57</td>
<td align="right">2.00</td>
<td align="right">-124.35</td>
<td align="right">-121.80</td>
<td align="right">-118.5</td>
<td align="right">-118.01</td>
<td align="right">-114</td>
<td align="left">▂▆▃▇▁</td>
</tr>
<tr class="even">
<td align="left">latitude</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">35.63</td>
<td align="right">2.14</td>
<td align="right">32.54</td>
<td align="right">33.93</td>
<td align="right">34.3</td>
<td align="right">37.71</td>
<td align="right">42</td>
<td align="left">▇▁▅▂▁</td>
</tr>
<tr class="odd">
<td align="left">housing_median_age</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">28.64</td>
<td align="right">12.59</td>
<td align="right">1.00</td>
<td align="right">18.00</td>
<td align="right">29.0</td>
<td align="right">37.00</td>
<td align="right">52</td>
<td align="left">▃▇▇▇▅</td>
</tr>
<tr class="even">
<td align="left">total_rooms</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">2635.76</td>
<td align="right">2181.62</td>
<td align="right">2.00</td>
<td align="right">1447.75</td>
<td align="right">2127.0</td>
<td align="right">3148.00</td>
<td align="right">39320</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="odd">
<td align="left">total_bedrooms</td>
<td align="right">207</td>
<td align="right">0.99</td>
<td align="right">537.87</td>
<td align="right">421.39</td>
<td align="right">1.00</td>
<td align="right">296.00</td>
<td align="right">435.0</td>
<td align="right">647.00</td>
<td align="right">6445</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td align="left">population</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">1425.48</td>
<td align="right">1132.46</td>
<td align="right">3.00</td>
<td align="right">787.00</td>
<td align="right">1166.0</td>
<td align="right">1725.00</td>
<td align="right">35682</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="odd">
<td align="left">households</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">499.54</td>
<td align="right">382.33</td>
<td align="right">1.00</td>
<td align="right">280.00</td>
<td align="right">409.0</td>
<td align="right">605.00</td>
<td align="right">6082</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td align="left">median_income</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">3.87</td>
<td align="right">1.90</td>
<td align="right">0.50</td>
<td align="right">2.56</td>
<td align="right">3.5</td>
<td align="right">4.74</td>
<td align="right">15</td>
<td align="left">▇▇▁▁▁</td>
</tr>
<tr class="odd">
<td align="left">rooms_per_household</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">5.43</td>
<td align="right">2.47</td>
<td align="right">0.85</td>
<td align="right">4.44</td>
<td align="right">5.2</td>
<td align="right">6.05</td>
<td align="right">142</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td align="left">bedrooms_per_room</td>
<td align="right">207</td>
<td align="right">0.99</td>
<td align="right">0.21</td>
<td align="right">0.06</td>
<td align="right">0.10</td>
<td align="right">0.18</td>
<td align="right">0.2</td>
<td align="right">0.24</td>
<td align="right">1</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="odd">
<td align="left">population_per_household</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">3.07</td>
<td align="right">10.39</td>
<td align="right">0.69</td>
<td align="right">2.43</td>
<td align="right">2.8</td>
<td align="right">3.28</td>
<td align="right">1243</td>
<td align="left">▇▁▁▁▁</td>
</tr>
</tbody>
</table></div>
<p>We have 20640 observations and 13 columns in our data.</p>
<ul>
<li><p>The <code>sd</code> column shows the standard deviation, which measures how dispersed the values are.</p></li>
<li><p>The p0, p25, p50, p75 and p100 columns show the corresponding percentiles: a percentile indicates the value below which a given percentage of observations in a group of observations fall. For example, 25% of the districts have a <code>housing_median_age</code> lower than 18, while 50% are lower than 29 and 75% are lower than 37. These are often called the 25th percentile (or first quartile), the median, and the 75th percentile.</p></li>
<li><p>Further note that the <strong>median income</strong> attribute does not look like it is expressed in US dollars (USD). Actually the data has been scaled and capped at 15 (actually, 15.0001) for higher median incomes, and at 0.5 (actually, 0.4999) for lower median incomes. The numbers represent roughly tens of thousands of dollars (e.g., 3 actually means about $30,000).</p></li>
</ul>
<p>Another quick way to get an overview of the type of data you are dealing with is to plot a histogram for each numerical attribute. A histogram shows the number of instances (on the vertical axis) that have a given value range (on the horizontal axis). You can either plot this one attribute at a time, or you can use <code>ggscatmat</code> from the package <code>GGally</code> on the whole dataset (as shown in the following code example), and it will plot a histogram for each numerical attribute as well as correlation coefficients (Pearson is the default). We just select the most promising variabels for our plot:</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggobi.github.io/ggally/">GGally</a></span><span class="op">)</span>

<span class="va">housing_df</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span>
    <span class="va">housing_median_age</span>, 
    <span class="va">median_income</span>, <span class="va">bedrooms_per_room</span>, <span class="va">rooms_per_household</span>, 
    <span class="va">population_per_household</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://ggobi.github.io/ggally/reference/ggscatmat.html">ggscatmat</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="Tidymodels_files/figure-html/unnamed-chunk-75-1.png" width="100%" height="100%" style="display: block; margin: auto;"></div>
<p>Another option is to use <code>ggpairs</code>, where we even can integrate categorical variables like our dependent variable <code>price_category</code> and ocean proximity in the output:</p>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggobi.github.io/ggally/">GGally</a></span><span class="op">)</span>

<span class="va">housing_df</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span>
    <span class="va">housing_median_age</span>, 
    <span class="va">median_income</span>, <span class="va">bedrooms_per_room</span>, <span class="va">rooms_per_household</span>, 
    <span class="va">population_per_household</span>, <span class="va">ocean_proximity</span>,
    <span class="va">price_category</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://ggobi.github.io/ggally/reference/ggpairs.html">ggpairs</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="Tidymodels_files/figure-html/unnamed-chunk-76-1.png" width="100%" height="100%" style="display: block; margin: auto;"></div>
<p>There are a few things you might notice in these histograms:</p>
<ul>
<li><p>The variables <em>median income</em>, <em>housing median age</em> were capped.</p></li>
<li><p>Note that our attributes have very different scales. We will take care of this issue later in data preparation, when we use feature scaling (data normalization).</p></li>
<li><p>Finally, many histograms are tail-heavy: they extend much farther to the right of the median than to the left. This may make it a bit harder for some Machine Learning algorithms to detect patterns. We will transform these attributes later on to have more bell-shaped distributions. For our right-skewed data (i.e., tail is on the right, also called positive skew), common transformations include square root and log (we will use the log).</p></li>
</ul>
</div>
<div id="data-splitting-1" class="section level2" number="9.7">
<h2>
<span class="header-section-number">9.7</span> Data splitting<a class="anchor" aria-label="anchor" href="#data-splitting-1"><i class="fas fa-link"></i></a>
</h2>
<p>Before we get started with our in-depth data exploration, let’s split our single dataset into two: a training set and a testing set. The training data will be used to fit models, and the testing set will be used to measure model performance. We perform data exploration only on the training data.</p>
<p>A <strong>training dataset</strong> is a dataset of examples used during the learning process and is used to fit the models. A <strong>test dataset</strong> is a dataset that is independent of the training dataset and is used to evaluate the performance of the final model. If a model fit to the training dataset also fits the test dataset well, minimal <em>overfitting</em> has taken place. A better fitting of the training dataset as opposed to the test dataset usually points to overfitting.</p>
<p>In our data split, we want to ensure that the training and test set is representative of the categories of our dependent variable. Take a look at <a href="data-understanding-2.html#fig:hist-med-value-class">9.1</a></p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">housing_df</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">price_category</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_bar</span><span class="op">(</span><span class="op">)</span> </code></pre></div>
<div class="figure" style="text-align: center">
<span id="fig:hist-med-value-class"></span>
<img src="Tidymodels_files/figure-html/hist-med-value-class-1.png" alt="Histogram of Median Proces" width="80%" height="100%"><p class="caption">
Figure 9.1: Histogram of Median Proces
</p>
</div>
<p>In general, we would like to have instances for each <em>stratum</em>, or else the estimate of a stratum’s importance may be biased. A <em>stratum</em> (plural strata) refers to a subset (part) of the whole data from which is being sampled. We only have two categories in our data.</p>
<p>To actually split the data, we can use the <code>rsample</code> package (included in <code>tidymodels</code>) to create an object that contains the information on how to split the data (which we call <code>data_split</code>), and then two more <code>rsample</code> functions to create data frames for the training and testing sets:</p>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># Fix the random numbers by setting the seed </span>
<span class="co"># This enables the analysis to be reproducible </span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span>

<span class="co"># Put 3/4 of the data into the training set </span>
<span class="va">data_split</span> <span class="op">&lt;-</span> <span class="fu">initial_split</span><span class="op">(</span><span class="va">housing_df</span>, 
                           prop <span class="op">=</span> <span class="fl">3</span><span class="op">/</span><span class="fl">4</span>, 
                           strata <span class="op">=</span> <span class="va">price_category</span><span class="op">)</span>

<span class="co"># Create dataframes for the two sets:</span>
<span class="va">train_data</span> <span class="op">&lt;-</span> <span class="fu">training</span><span class="op">(</span><span class="va">data_split</span><span class="op">)</span> 
<span class="va">test_data</span> <span class="op">&lt;-</span> <span class="fu">testing</span><span class="op">(</span><span class="va">data_split</span><span class="op">)</span></code></pre></div>
</div>
<div id="data-exploration-1" class="section level2" number="9.8">
<h2>
<span class="header-section-number">9.8</span> Data exploration<a class="anchor" aria-label="anchor" href="#data-exploration-1"><i class="fas fa-link"></i></a>
</h2>
<p>The point of data exploration is to gain insights that will help you select important variables for your model and to get ideas for feature engineering in the data preparation phase. Ususally, data exploration is an iterative process: once you get a prototype model up and running, you can analyze its output to gain more insights and come back to this exploration step. It is important to note that we perform data exploration only with our training data.</p>
<div id="create-data-copy-1" class="section level3" number="9.8.1">
<h3>
<span class="header-section-number">9.8.1</span> Create data copy<a class="anchor" aria-label="anchor" href="#create-data-copy-1"><i class="fas fa-link"></i></a>
</h3>
<p>We first make a copy of the training data since we don’t want to alter our data during data exploration.</p>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">data_explore</span> <span class="op">&lt;-</span> <span class="va">train_data</span></code></pre></div>
<p>Next, we take a closer look at the relationships between our variables. In particular, we are interested in the relationships between our <em>dependent</em> variable <code>price_category</code> and all other variables. The goal is to identify possible <em>predictor variables</em> which we could use in our models to predict the <code>price_category</code>.</p>
</div>
<div id="geographical-overview-1" class="section level3" number="9.8.2">
<h3>
<span class="header-section-number">9.8.2</span> Geographical overview<a class="anchor" aria-label="anchor" href="#geographical-overview-1"><i class="fas fa-link"></i></a>
</h3>
<p>Since our data includes information about <code>longitude</code> and <code>latitude</code>, we start our data exploration with the creation of a geographical scatterplot of the data to get some first insights:</p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">data_explore</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">longitude</span>, y <span class="op">=</span> <span class="va">latitude</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"cornflowerblue"</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span id="fig:point-long-lat-class"></span>
<img src="Tidymodels_files/figure-html/point-long-lat-class-1.png" alt="Scatterplot of longitude and latitude" width="80%" height="100%"><p class="caption">
Figure 9.2: Scatterplot of longitude and latitude
</p>
</div>
<p>A better visualization that highlights high-density areas (with parameter <code>alpha = 0.1</code> ):</p>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">data_explore</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">longitude</span>, y <span class="op">=</span> <span class="va">latitude</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"cornflowerblue"</span>, alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> 
  </code></pre></div>
<div class="figure" style="text-align: center">
<span id="fig:point-long-lat-a-class"></span>
<img src="Tidymodels_files/figure-html/point-long-lat-a-class-1.png" alt="Scatterplot of longitude and latitude that highlights high-density areas" width="80%" height="100%"><p class="caption">
Figure 9.3: Scatterplot of longitude and latitude that highlights high-density areas
</p>
</div>
<p>Overview about California housing prices:</p>
<ul>
<li>red is expensive,</li>
<li>purple is cheap and</li>
<li>larger circles indicate areas with a larger population.</li>
</ul>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">data_explore</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">longitude</span>, y <span class="op">=</span> <span class="va">latitude</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>size <span class="op">=</span> <span class="va">population</span>, color <span class="op">=</span> <span class="va">price_category</span><span class="op">)</span>, 
             alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span id="fig:plot-ca-prices-class"></span>
<img src="Tidymodels_files/figure-html/plot-ca-prices-class-1.png" alt="California housing_df prices" width="80%" height="100%"><p class="caption">
Figure 9.4: California housing_df prices
</p>
</div>
<p>Lastly, we add a map to our data:</p>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dkahle/ggmap">ggmap</a></span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/qmplot.html">qmplot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">longitude</span>, 
       y <span class="op">=</span> <span class="va">latitude</span>, 
       data <span class="op">=</span> <span class="va">data_explore</span>, 
       geom <span class="op">=</span> <span class="st">"point"</span>, 
       color <span class="op">=</span> <span class="va">price_category</span>, 
       size <span class="op">=</span> <span class="va">population</span>,
       alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_alpha</span><span class="op">(</span>guide <span class="op">=</span> <span class="st">'none'</span><span class="op">)</span> <span class="co"># don't show legend for alpha</span></code></pre></div>
<div class="inline-figure"><img src="Tidymodels_files/figure-html/unnamed-chunk-79-1.png" width="100%" height="100%" style="display: block; margin: auto;"></div>
<p>This image tells you that the housing prices are very much related to the location (e.g., close to the ocean) and to the population density. Hence our <code>ocean_proximity</code> variable may be a useful predictor of our categorical price variable median housing prices, although in Northern California the housing prices in coastal districts are not too high, so it is not a simple rule.</p>
</div>
<div id="numerical-variables" class="section level3" number="9.8.3">
<h3>
<span class="header-section-number">9.8.3</span> Numerical variables<a class="anchor" aria-label="anchor" href="#numerical-variables"><i class="fas fa-link"></i></a>
</h3>
<p>We can use boxplots to check, if we actually find differences in our numeric variables for the different levels of our dependent <em>categorical variable</em>:</p>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">data_explore</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">price_category</span>, y <span class="op">=</span> <span class="va">median_income</span>, 
             fill <span class="op">=</span> <span class="va">price_category</span>, color <span class="op">=</span> <span class="va">price_category</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_boxplot</span><span class="op">(</span>alpha<span class="op">=</span><span class="fl">0.4</span><span class="op">)</span> 
  </code></pre></div>
<div class="inline-figure"><img src="Tidymodels_files/figure-html/unnamed-chunk-80-1.png" width="100%" height="100%" style="display: block; margin: auto;"></div>
<p>Let`s define a function for this task that accepts strings as inputs so we don’t have to copy and paste our code for every plot. Note that we only have to change the “y-variable” in every plot.</p>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">print_boxplot</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">.y_var</span><span class="op">)</span><span class="op">{</span>
  
  <span class="co"># convert strings to variable</span>
  <span class="va">y_var</span> <span class="op">&lt;-</span> <span class="fu">sym</span><span class="op">(</span><span class="va">.y_var</span><span class="op">)</span> 
 
  <span class="co"># unquote variables using {{}}</span>
  <span class="va">data_explore</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">price_category</span>, y <span class="op">=</span> <span class="op">{</span><span class="op">{</span><span class="va">y_var</span><span class="op">}</span><span class="op">}</span>,
             fill <span class="op">=</span> <span class="va">price_category</span>, color <span class="op">=</span> <span class="va">price_category</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_boxplot</span><span class="op">(</span>alpha<span class="op">=</span><span class="fl">0.4</span><span class="op">)</span> 
  
<span class="op">}</span>  </code></pre></div>
<p>Obtain all of the names of the y-variables we want to use for our plots:</p>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">y_var</span> <span class="op">&lt;-</span> 
  <span class="va">data_explore</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span>, <span class="op">-</span><span class="va">longitude</span>, <span class="op">-</span> <span class="va">latitude</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/case.names.html">variable.names</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># obtain name</span></code></pre></div>
<p>The map function applys the function <code>print_boxplot</code> to each element of our atomic vector <code>y_var</code> and returns the according plot:</p>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://purrr.tidyverse.org">purrr</a></span><span class="op">)</span>

<span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">y_var</span>, <span class="va">print_boxplot</span><span class="op">)</span>
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[3]]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[4]]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[5]]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[6]]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[7]]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[8]]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[9]]</span></code></pre></div>
<p><img src="Tidymodels_files/figure-html/unnamed-chunk-83-1.png" width="100%" height="100%" style="display: block; margin: auto;"><img src="Tidymodels_files/figure-html/unnamed-chunk-83-2.png" width="100%" height="100%" style="display: block; margin: auto;"><img src="Tidymodels_files/figure-html/unnamed-chunk-83-3.png" width="100%" height="100%" style="display: block; margin: auto;"><img src="Tidymodels_files/figure-html/unnamed-chunk-83-4.png" width="100%" height="100%" style="display: block; margin: auto;"><img src="Tidymodels_files/figure-html/unnamed-chunk-83-5.png" width="100%" height="100%" style="display: block; margin: auto;"><img src="Tidymodels_files/figure-html/unnamed-chunk-83-6.png" width="100%" height="100%" style="display: block; margin: auto;"><img src="Tidymodels_files/figure-html/unnamed-chunk-83-7.png" width="100%" height="100%" style="display: block; margin: auto;"><img src="Tidymodels_files/figure-html/unnamed-chunk-83-8.png" width="100%" height="100%" style="display: block; margin: auto;"><img src="Tidymodels_files/figure-html/unnamed-chunk-83-9.png" width="100%" height="100%" style="display: block; margin: auto;"></p>
<p>We can observe a difference in the price_category:</p>
<ul>
<li><p>The differences between our two groups are quite small for <code>housing_median_age</code>, <code>total_room</code>, <code>total_bedrooms</code>, <code>population</code> and <code>households</code></p></li>
<li><p>We can observe a noticeable difference for our variables <code>median_income</code> and <code>bedrooms_per_room</code></p></li>
<li><p><code>population_per_household</code> and <code>rooms_per_household</code> include some extreme values We first need to fix this before we can proceed with our interpretations for this variabels.</p></li>
</ul>
<p>Again, let’s write a short function for this task and filter some of the extreme cases. We call the new function <code>print_boxplot_out</code>:</p>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">print_boxplot_out</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">.y_var_out</span><span class="op">)</span><span class="op">{</span>
  
  <span class="va">y_var</span> <span class="op">&lt;-</span> <span class="fu">sym</span><span class="op">(</span><span class="va">.y_var_out</span><span class="op">)</span> 
 
  <span class="va">data_explore</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">rooms_per_household</span> <span class="op">&lt;</span> <span class="fl">50</span>, <span class="va">population_per_household</span> <span class="op">&lt;</span> <span class="fl">20</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">price_category</span>, y <span class="op">=</span> <span class="op">{</span><span class="op">{</span><span class="va">y_var</span><span class="op">}</span><span class="op">}</span>,
             fill <span class="op">=</span> <span class="va">price_category</span>, color <span class="op">=</span> <span class="va">price_category</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_boxplot</span><span class="op">(</span>alpha<span class="op">=</span><span class="fl">0.4</span><span class="op">)</span> 
  
<span class="op">}</span> 

<span class="va">y_var_out</span> <span class="op">&lt;-</span> 
  <span class="va">data_explore</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">rooms_per_household</span>, <span class="va">population_per_household</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/case.names.html">variable.names</a></span><span class="op">(</span><span class="op">)</span> 

<span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">y_var_out</span>, <span class="va">print_boxplot_out</span><span class="op">)</span>
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span></code></pre></div>
<p><img src="Tidymodels_files/figure-html/unnamed-chunk-84-1.png" width="100%" height="100%" style="display: block; margin: auto;"><img src="Tidymodels_files/figure-html/unnamed-chunk-84-2.png" width="100%" height="100%" style="display: block; margin: auto;"></p>
<p>Now we are able to recognize a small difference for <code>population_per_household</code>. <code>rooms_per_household</code> on the other hand is quite similar for both groups.</p>
<p>Additionally, we can use the function <code>ggscatmat</code> to create plots with our dependent variable as color column:</p>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggobi.github.io/ggally/">GGally</a></span><span class="op">)</span>

<span class="va">data_explore</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">price_category</span>, <span class="va">median_income</span>, <span class="va">bedrooms_per_room</span>, <span class="va">rooms_per_household</span>, 
         <span class="va">population_per_household</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://ggobi.github.io/ggally/reference/ggscatmat.html">ggscatmat</a></span><span class="op">(</span>color<span class="op">=</span><span class="st">"price_category"</span>, 
            corMethod <span class="op">=</span> <span class="st">"spearman"</span>,
            alpha<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="Tidymodels_files/figure-html/unnamed-chunk-85-1.png" width="100%" height="100%" style="display: block; margin: auto;"></div>
<p>There are a few things you might notice in these histograms:</p>
<ul>
<li><p>Note that our attributes have very different scales. We will take care of this issue later in data preparation, when we use feature scaling (data normalization).</p></li>
<li><p>The histograms are tail-heavy: they extend much farther to the right of the median than to the left. This may make it a bit harder for some Machine Learning algorithms to detect patterns. We will transform these attributes later on to have more bell-shaped distributions. For our right-skewed data (i.e., tail is on the right, also called positive skew), common transformations include square root and log (we will use the log).</p></li>
</ul>
<p>As a result of our data exploration, we will include the numerical variables</p>
<ul>
<li>
<code>median_income</code>,</li>
<li>
<code>bedrooms_per_room</code> and</li>
<li><code>population_per_household</code></li>
</ul>
<p>as predictors in our model.</p>
</div>
<div id="categorical-variables" class="section level3" number="9.8.4">
<h3>
<span class="header-section-number">9.8.4</span> Categorical variables<a class="anchor" aria-label="anchor" href="#categorical-variables"><i class="fas fa-link"></i></a>
</h3>
<p>Now let’s analyze the relationship between our categorical variables <code>ocean proximity</code> and <code>price_category</code>. We start with a simple count.</p>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rstudio/gt">gt</a></span><span class="op">)</span>

<span class="va">data_explore</span> <span class="op">%&gt;%</span> 
  <span class="fu">count</span><span class="op">(</span><span class="va">price_category</span>, <span class="va">ocean_proximity</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">group_by</span><span class="op">(</span><span class="va">price_category</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>percent <span class="op">=</span> <span class="va">n</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/gt/man/gt.html">gt</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://rdrr.io/pkg/gt/man/tab_header.html">tab_header</a></span><span class="op">(</span>
    title <span class="op">=</span> <span class="st">"California median house prices"</span>,
    subtitle <span class="op">=</span> <span class="st">"Districts above and below 150.000$"</span>
  <span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/gt/man/cols_label.html">cols_label</a></span><span class="op">(</span>
    ocean_proximity <span class="op">=</span> <span class="st">"Ocean Proximity"</span>,
    n <span class="op">=</span> <span class="st">"Districts"</span>,
    percent <span class="op">=</span> <span class="st">"Percent"</span>
  <span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/gt/man/fmt_number.html">fmt_number</a></span><span class="op">(</span>
    columns <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>,
    suffixing <span class="op">=</span> <span class="cn">TRUE</span>
  <span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/gt/man/fmt_percent.html">fmt_percent</a></span><span class="op">(</span>
    columns <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">percent</span><span class="op">)</span>,
    decimal <span class="op">=</span> <span class="fl">2</span>
  <span class="op">)</span> </code></pre></div>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#xmjcfzubex .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#xmjcfzubex .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#xmjcfzubex .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#xmjcfzubex .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#xmjcfzubex .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xmjcfzubex .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#xmjcfzubex .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#xmjcfzubex .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#xmjcfzubex .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#xmjcfzubex .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#xmjcfzubex .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#xmjcfzubex .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#xmjcfzubex .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#xmjcfzubex .gt_from_md > :first-child {
  margin-top: 0;
}

#xmjcfzubex .gt_from_md > :last-child {
  margin-bottom: 0;
}

#xmjcfzubex .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#xmjcfzubex .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#xmjcfzubex .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#xmjcfzubex .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#xmjcfzubex .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#xmjcfzubex .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#xmjcfzubex .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#xmjcfzubex .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xmjcfzubex .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#xmjcfzubex .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#xmjcfzubex .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#xmjcfzubex .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#xmjcfzubex .gt_left {
  text-align: left;
}

#xmjcfzubex .gt_center {
  text-align: center;
}

#xmjcfzubex .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#xmjcfzubex .gt_font_normal {
  font-weight: normal;
}

#xmjcfzubex .gt_font_bold {
  font-weight: bold;
}

#xmjcfzubex .gt_font_italic {
  font-style: italic;
}

#xmjcfzubex .gt_super {
  font-size: 65%;
}

#xmjcfzubex .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="xmjcfzubex" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><div class="inline-table"><table class="gt_table">
<thead class="gt_header">
<tr>
<th colspan="3" class="gt_heading gt_title gt_font_normal" style>California median house prices</th>
    </tr>
<tr>
<th colspan="3" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style>Districts above and below 150.000$</th>
    </tr>
</thead>
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">Ocean Proximity</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">Districts</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Percent</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr class="gt_group_heading_row">
<td colspan="3" class="gt_group_heading">above</td>
    </tr>
<tr>
<td class="gt_row gt_center">&lt;1H OCEAN</td>
      <td class="gt_row gt_center">5.69K</td>
      <td class="gt_row gt_right">57.96&amp;percnt;</td>
    </tr>
<tr>
<td class="gt_row gt_center">INLAND</td>
      <td class="gt_row gt_center">1.19K</td>
      <td class="gt_row gt_right">12.15&amp;percnt;</td>
    </tr>
<tr>
<td class="gt_row gt_center">ISLAND</td>
      <td class="gt_row gt_center">4.00</td>
      <td class="gt_row gt_right">0.04&amp;percnt;</td>
    </tr>
<tr>
<td class="gt_row gt_center">NEAR BAY</td>
      <td class="gt_row gt_center">1.42K</td>
      <td class="gt_row gt_right">14.42&amp;percnt;</td>
    </tr>
<tr>
<td class="gt_row gt_center">NEAR OCEAN</td>
      <td class="gt_row gt_center">1.51K</td>
      <td class="gt_row gt_right">15.43&amp;percnt;</td>
    </tr>
<tr class="gt_group_heading_row">
<td colspan="3" class="gt_group_heading">below</td>
    </tr>
<tr>
<td class="gt_row gt_center">&lt;1H OCEAN</td>
      <td class="gt_row gt_center">1.17K</td>
      <td class="gt_row gt_right">20.72&amp;percnt;</td>
    </tr>
<tr>
<td class="gt_row gt_center">INLAND</td>
      <td class="gt_row gt_center">3.66K</td>
      <td class="gt_row gt_right">64.53&amp;percnt;</td>
    </tr>
<tr>
<td class="gt_row gt_center">NEAR BAY</td>
      <td class="gt_row gt_center">332.00</td>
      <td class="gt_row gt_right">5.86&amp;percnt;</td>
    </tr>
<tr>
<td class="gt_row gt_center">NEAR OCEAN</td>
      <td class="gt_row gt_center">504.00</td>
      <td class="gt_row gt_right">8.89&amp;percnt;</td>
    </tr>
</tbody>
</table></div></div>
<p>The function <code>geom_bin2d()</code> creats a heatmap by counting the number of cases in each group, and then mapping the number of cases to each subgroub’s fill.</p>
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data_explore</span> <span class="op">%&gt;%</span>
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">price_category</span>, <span class="va">ocean_proximity</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_bin2d</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_fill_continuous</span><span class="op">(</span>type <span class="op">=</span> <span class="st">"viridis"</span><span class="op">)</span> </code></pre></div>
<div class="inline-figure"><img src="Tidymodels_files/figure-html/unnamed-chunk-87-1.png" width="100%" height="100%" style="display: block; margin: auto;"></div>
<p>We can observe that most districts with a median house price above 150,000 have an ocean proximity below 1 hour. On the other hand, districts below that threshold are typically inland. Hence, ocean proximity is indeed a good predictor for our two different median house value categories.</p>
</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="business-understanding-2.html"><span class="header-section-number">8</span> Business understanding</a></div>
<div class="next"><a href="data-preparation-3.html"><span class="header-section-number">10</span> Data preparation</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#data-understanding-2"><span class="header-section-number">9</span> Data understanding</a></li>
<li><a class="nav-link" href="#imort-data-1"><span class="header-section-number">9.1</span> Imort Data</a></li>
<li><a class="nav-link" href="#clean-data-1"><span class="header-section-number">9.2</span> Clean data</a></li>
<li><a class="nav-link" href="#format-data-1"><span class="header-section-number">9.3</span> Format data</a></li>
<li><a class="nav-link" href="#missing-data-1"><span class="header-section-number">9.4</span> Missing data</a></li>
<li><a class="nav-link" href="#create-new-variables-1"><span class="header-section-number">9.5</span> Create new variables</a></li>
<li><a class="nav-link" href="#data-overview-1"><span class="header-section-number">9.6</span> Data overview</a></li>
<li><a class="nav-link" href="#data-splitting-1"><span class="header-section-number">9.7</span> Data splitting</a></li>
<li>
<a class="nav-link" href="#data-exploration-1"><span class="header-section-number">9.8</span> Data exploration</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#create-data-copy-1"><span class="header-section-number">9.8.1</span> Create data copy</a></li>
<li><a class="nav-link" href="#geographical-overview-1"><span class="header-section-number">9.8.2</span> Geographical overview</a></li>
<li><a class="nav-link" href="#numerical-variables"><span class="header-section-number">9.8.3</span> Numerical variables</a></li>
<li><a class="nav-link" href="#categorical-variables"><span class="header-section-number">9.8.4</span> Categorical variables</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/kirenz/tidymodels/blob/master/03-classification.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/kirenz/tidymodels/edit/master/03-classification.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Regression and Classification with Tidymodels</strong>" was written by Jan Kirenz. It was last built on 2021-02-11.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
